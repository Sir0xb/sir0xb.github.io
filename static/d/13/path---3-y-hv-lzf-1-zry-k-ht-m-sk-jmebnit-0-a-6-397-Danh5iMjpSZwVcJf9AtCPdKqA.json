{"data":{"markdownRemark":{"html":"<p>思路：每次关闭时，讲日志文件改名成日期时间相关的文件即可。因为 Nginx 启动时会自动生成日志文件。</p>\n<p>bat代码如下：</p>\n<pre><code class=\"language-bash\">cls\n@ECHO OFF\nSET NGINX_PATH=C:\nSET NGINX_DIR=C:\\nginx-1.1.5\\\ncolor 0a\nTITLE Nginx管理程序\nGOTO MENU\n:MENU\nCLS\nECHO.\nECHO. * * * *  Nginx Management  * * *\nECHO. *                                *\nECHO. *   1 启动Nginx                  *\nECHO. *                                *\nECHO. *   2 关闭Nginx                  *\nECHO. *                                *\nECHO. *   3 重启Nginx                  *\nECHO. *                                *\nECHO. *   4 检查配置                   *\nECHO. *                                *\nECHO. *   5 退 出                      *\nECHO. *                                *\nECHO. * * * * * * * * * * * * * * * * *\nECHO.\nECHO.请输入命令编号:\nset /p ID=\nIF \"%id%\"==\"1\" GOTO cmd1\nIF \"%id%\"==\"2\" GOTO cmd2\nIF \"%id%\"==\"3\" GOTO cmd3\nIF \"%id%\"==\"4\" GOTO cmd4\nIF \"%id%\"==\"5\" EXIT\nPAUSE\n\n:cmd1\nREM ------------- 启动PHP -------------\n@ECHO OFF\nSET PHP_FCGI_MAX_REQUESTS=1000\nECHO.启动PHP FastCGI...\n%NGINX_PATH%\nCD %NGINX_DIR%\nRunHiddenConsole %NGINX_DIR%/php-5.3.8/php-cgi.exe -b 127.0.0.1:9000 -c %NGINX_DIR%/php-5.3.8/php.ini\n\nREM ------------- 启动Nginx -------------\nECHO.启动Nginx......\n%NGINX_PATH%\nCD %NGINX_DIR%\nIF NOT EXIST %NGINX_DIR%nginx.exe ECHO %NGINX_DIR%nginx.exe不存在\n%NGINX_PATH%\nCD %NGINX_DIR%\nIF EXIST %NGINX_DIR% start %NGINX_DIR%nginx.exe\nECHO.OK\nPAUSE\nGOTO MENU\n\n:cmd2\nECHO.\nREM ------------- 日志文件改名 -------------\nSET T1=%DATE:~0,4%.%DATE:~5,2%.%DATE:~8,2%.%time:~0,2%.%time:~3,2%.%time:~6,2%\nSET T2=%T1: =0%\n%NGINX_PATH%\nCD %NGINX_DIR%\nIF NOT EXIST %NGINX_DIR%logs\\%T2%_ACCESS.log ren %NGINX_DIR%logs\\access.log %T2%_ACCESS.log\n%NGINX_PATH%\nCD %NGINX_DIR%\nIF NOT EXIST %NGINX_DIR%logs\\%T2%_ERROR.log ren %NGINX_DIR%logs\\error.log %T2%_ERROR.log\n\nREM ------------- 关闭Nginx -------------\nECHO.关闭Nginx......\n%NGINX_PATH%\nCD %NGINX_DIR%\ntaskkill /F /IM nginx.exe > nul\nREM ------------- 关闭PHP -------------\nECHO.关闭 PHP FastCGI...\n%NGINX_PATH%\nCD %NGINX_DIR%\ntaskkill /F /IM php-cgi.exe > nul\nECHO.OK\nPAUSE\nGOTO MENU\n\n:cmd3\nECHO.\nREM ------------- 关闭Nginx -------------\nECHO.关闭Nginx......\n%NGINX_PATH%\nCD %NGINX_DIR%\ntaskkill /F /IM nginx.exe > nul\nREM ------------- 关闭PHP -------------\nECHO.关闭PHP FastCGI...\n%NGINX_PATH%\nCD %NGINX_DIR%\ntaskkill /F /IM php-cgi.exe > nul\nECHO.OK\nGOTO cmd1\nGOTO MENU\n\n:cmd4\nECHO.\nREM ------------- 检查Nginx配置 -------------\nECHO.检查Nginx配置......\n%NGINX_PATH%\nCD %NGINX_DIR%\nIF NOT EXIST %NGINX_DIR%nginx.exe ECHO %NGINX_DIR%nginx.exe不存在\n%NGINX_PATH%\nCD %NGINX_DIR%\nIF EXIST %NGINX_DIR% %NGINX_DIR%nginx.exe -t\nECHO.完成检查\nPAUSE\nGOTO MENU\n</code></pre>\n<!--more-->\n<p>运行效果如下：</p>\n<img src=\"https://i.imgur.com/RadjhED.png\" />\n<p>重新启动 Nginx 后：</p>\n<img src=\"https://i.imgur.com/pb35nV3.png\" />\n<hr>","frontmatter":{"path":"/3YHvLZF1ZryKHtMSkJmebnit","title":"Windows环境下 Nginx 日志分割","author":"Sir0xb","date":"2011-12-30 10:12:05 +0800"}}},"pageContext":{}}