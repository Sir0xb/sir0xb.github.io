{"data":{"markdownRemark":{"html":"<blockquote>\n<p>为了演示流控制，简单实现了注入插件 gulp-aop</p>\n</blockquote>\n<h3>先看下 gulp-aop 注入插件的用法</h3>\n<pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"source coffee\"><span class=\"variable assignment coffee\"><span class=\"variable assignment coffee\"><span>gulp&nbsp;</span><span class=\"keyword operator coffee\"><span>=</span></span></span></span><span>&nbsp;</span><span class=\"support function coffee\"><span>require</span></span><span>&nbsp;</span><span class=\"string quoted double coffee\"><span class=\"punctuation definition string begin coffee\"><span>&quot;</span></span><span>gulp</span><span class=\"punctuation definition string end coffee\"><span>&quot;</span></span></span></span></div><div class=\"line\"><span class=\"source coffee\"><span class=\"variable assignment coffee\"><span class=\"variable assignment coffee\"><span>concat&nbsp;</span><span class=\"keyword operator coffee\"><span>=</span></span></span></span><span>&nbsp;</span><span class=\"support function coffee\"><span>require</span></span><span>&nbsp;</span><span class=\"string quoted double coffee\"><span class=\"punctuation definition string begin coffee\"><span>&quot;</span></span><span>gulp-concat</span><span class=\"punctuation definition string end coffee\"><span>&quot;</span></span></span></span></div><div class=\"line\"><span class=\"source coffee\"><span class=\"variable assignment coffee\"><span class=\"variable assignment coffee\"><span>aop&nbsp;</span><span class=\"keyword operator coffee\"><span>=</span></span></span></span><span>&nbsp;</span><span class=\"support function coffee\"><span>require</span></span><span>&nbsp;</span><span class=\"string quoted double coffee\"><span class=\"punctuation definition string begin coffee\"><span>&quot;</span></span><span>gulp-aop</span><span class=\"punctuation definition string end coffee\"><span>&quot;</span></span></span></span></div><div class=\"line\"><span class=\"source coffee\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"source coffee\"><span>gulp</span><span class=\"meta delimiter method period coffee\"><span>.</span></span><span>task&nbsp;</span><span class=\"string quoted double coffee\"><span class=\"punctuation definition string begin coffee\"><span>&quot;</span></span><span>default</span><span class=\"punctuation definition string end coffee\"><span>&quot;</span></span></span><span class=\"meta delimiter object comma coffee\"><span>,&nbsp;</span></span><span class=\"storage type function coffee\"><span>-&gt;</span></span></span></div><div class=\"line\"><span class=\"source coffee\"><span>&nbsp;&nbsp;&nbsp;&nbsp;gulp</span><span class=\"meta delimiter method period coffee\"><span>.</span></span><span>src&nbsp;</span><span class=\"meta brace square coffee\"><span>[</span></span><span class=\"string quoted double coffee\"><span class=\"punctuation definition string begin coffee\"><span>&quot;</span></span><span>test/a.js</span><span class=\"punctuation definition string end coffee\"><span>&quot;</span></span></span><span class=\"meta delimiter object comma coffee\"><span>,&nbsp;</span></span><span class=\"string quoted double coffee\"><span class=\"punctuation definition string begin coffee\"><span>&quot;</span></span><span>test/b.js</span><span class=\"punctuation definition string end coffee\"><span>&quot;</span></span></span><span class=\"meta brace square coffee\"><span>]</span></span></span></div><div class=\"line\"><span class=\"source coffee\"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"meta delimiter method period coffee\"><span>.</span></span><span>pipe&nbsp;concat&nbsp;</span><span class=\"string quoted double coffee\"><span class=\"punctuation definition string begin coffee\"><span>&quot;</span></span><span>t.min.js</span><span class=\"punctuation definition string end coffee\"><span>&quot;</span></span></span></span></div><div class=\"line\"><span class=\"source coffee\"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"meta delimiter method period coffee\"><span>.</span></span><span>pipe&nbsp;aop</span></span></div><div class=\"line\"><span class=\"source coffee\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"meta function coffee\"><span class=\"entity name function coffee\"><span>header</span></span></span><span class=\"keyword operator coffee\"><span>:</span></span><span>&nbsp;</span><span class=\"storage type function coffee\"><span>-&gt;</span></span><span>&nbsp;</span><span class=\"entity name type object coffee\"><span>console</span></span><span class=\"meta delimiter method period coffee\"><span>.</span></span><span class=\"support function console coffee\"><span>log</span></span><span>&nbsp;</span><span class=\"string quoted single coffee\"><span class=\"punctuation definition string begin coffee\"><span>&#39;</span></span><span>Inject&nbsp;to&nbsp;the&nbsp;head</span><span class=\"punctuation definition string end coffee\"><span>&#39;</span></span></span></span></div><div class=\"line\"><span class=\"source coffee\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"meta function coffee\"><span class=\"entity name function coffee\"><span>footer</span></span></span><span class=\"keyword operator coffee\"><span>:</span></span><span>&nbsp;</span><span class=\"storage type function coffee\"><span>-&gt;</span></span><span>&nbsp;</span><span class=\"entity name type object coffee\"><span>console</span></span><span class=\"meta delimiter method period coffee\"><span>.</span></span><span class=\"support function console coffee\"><span>log</span></span><span>&nbsp;</span><span class=\"string quoted single coffee\"><span class=\"punctuation definition string begin coffee\"><span>&#39;</span></span><span>Inject&nbsp;to&nbsp;the&nbsp;end</span><span class=\"punctuation definition string end coffee\"><span>&#39;</span></span></span></span></div><div class=\"line\"><span class=\"source coffee\"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"meta delimiter method period coffee\"><span>.</span></span><span>pipe&nbsp;gulp</span><span class=\"meta delimiter method period coffee\"><span>.</span></span><span>dest&nbsp;</span><span class=\"string quoted double coffee\"><span class=\"punctuation definition string begin coffee\"><span>&quot;</span></span><span>./test</span><span class=\"punctuation definition string end coffee\"><span>&quot;</span></span></span></span></div></pre>\n<!--more-->\n<p>了解 gulp 流控制之前先了解下 nodeJS 的流</p>\n<h2> </h2>\n<h3>nodeJS 四种流</h3>\n<p>nodeJS里有四种类型的流：Readable，Writable，Duplex，Transform</p>\n<p>Readable: 可读流</p>\n<p>Writable: 可写流</p>\n<p>Duplex: 双工流</p>\n<p>Transform: 转换流</p>\n<p>跟 Gulp 相关的主要是转换流</p>\n<blockquote>\n<p>gulp 流控制一般用如下两种方式</p>\n</blockquote>\n<h2> </h2>\n<h3>流截获方式一：</h3>\n<pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"source js\"><span class=\"storage type var js\"><span>var</span></span><span>&nbsp;through&nbsp;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&nbsp;</span><span class=\"meta function-call js\"><span class=\"support function js\"><span>require</span></span><span class=\"meta arguments js\"><span class=\"punctuation definition arguments begin bracket round js\"><span>(</span></span><span class=\"string quoted single js\"><span class=\"punctuation definition string begin js\"><span>&#39;</span></span><span>through-gulp</span><span class=\"punctuation definition string end js\"><span>&#39;</span></span></span><span class=\"punctuation definition arguments end bracket round js\"><span>)</span></span></span></span><span class=\"punctuation terminator statement js\"><span>;</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"support variable js\"><span>module</span></span><span class=\"meta function js\"><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"entity name function js\"><span>exports</span></span><span>&nbsp;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&nbsp;</span><span class=\"storage type function js\"><span>function</span></span><span>&nbsp;</span><span class=\"meta parameters js\"><span class=\"punctuation definition parameters begin bracket round js\"><span>(</span></span><span class=\"punctuation definition parameters end bracket round js\"><span>)</span></span></span></span><span>&nbsp;</span><span class=\"punctuation definition function body begin bracket curly js\"><span>{</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"storage type var js\"><span>var</span></span><span>&nbsp;stream&nbsp;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&nbsp;</span><span class=\"meta function-call js\"><span class=\"entity name function js\"><span>through</span></span><span class=\"meta arguments js\"><span class=\"punctuation definition arguments begin bracket round js\"><span>(</span></span><span class=\"meta function js\"><span class=\"storage type function js\"><span>function</span></span><span class=\"meta parameters js\"><span class=\"punctuation definition parameters begin bracket round js\"><span>(</span></span><span class=\"variable parameter function js\"><span>file</span></span><span class=\"meta delimiter object comma js\"><span>,</span></span><span>&nbsp;</span><span class=\"variable parameter function js\"><span>encoding</span></span><span class=\"meta delimiter object comma js\"><span>,</span></span><span>&nbsp;</span><span class=\"variable parameter function js\"><span>callback</span></span><span class=\"punctuation definition parameters end bracket round js\"><span>)</span></span></span></span><span>&nbsp;</span><span class=\"punctuation definition function body begin bracket curly js\"><span>{</span></span></span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"meta function-call js\"><span class=\"meta arguments js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"storage type var js\"><span>var</span></span><span>&nbsp;sourceStr&nbsp;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&nbsp;</span><span class=\"variable other object js\"><span>file</span></span><span class=\"meta delimiter property period js\"><span>.</span></span><span class=\"variable other object property js\"><span>contents</span></span><span class=\"meta method-call js\"><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"support function js\"><span>toString</span></span><span class=\"meta arguments js\"><span class=\"punctuation definition arguments begin bracket round js\"><span>(</span></span><span class=\"punctuation definition arguments end bracket round js\"><span>)</span></span></span></span><span class=\"punctuation terminator statement js\"><span>;</span></span></span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"meta function-call js\"><span class=\"meta arguments js\"><span>&nbsp;</span></span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"meta function-call js\"><span class=\"meta arguments js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"comment line double-slash js\"><span class=\"punctuation definition comment js\"><span>//</span></span><span>&nbsp;这里可以对代码进行处理</span></span></span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"meta function-call js\"><span class=\"meta arguments js\"><span>&nbsp;</span></span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"meta function-call js\"><span class=\"meta arguments js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"variable other object js\"><span>file</span></span><span class=\"meta delimiter property period js\"><span>.</span></span><span class=\"variable other property js\"><span>contents</span></span><span>&nbsp;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&nbsp;</span><span class=\"meta class instance constructor js\"><span class=\"keyword operator new js\"><span>new</span></span><span>&nbsp;</span><span class=\"entity name type instance js\"><span>Buffer</span></span></span><span class=\"meta brace round js\"><span>(</span></span><span>sourceStr</span><span class=\"meta brace round js\"><span>)</span></span><span class=\"punctuation terminator statement js\"><span>;</span></span></span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"meta function-call js\"><span class=\"meta arguments js\"><span>&nbsp;</span></span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"meta function-call js\"><span class=\"meta arguments js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"comment line double-slash js\"><span class=\"punctuation definition comment js\"><span>//</span></span><span>&nbsp;再往管道中注入修改后的内容</span></span></span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"meta function-call js\"><span class=\"meta arguments js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"variable language js\"><span>this</span></span><span class=\"meta method-call js\"><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"support function js\"><span>push</span></span><span class=\"meta arguments js\"><span class=\"punctuation definition arguments begin bracket round js\"><span>(</span></span><span>file</span><span class=\"punctuation definition arguments end bracket round js\"><span>)</span></span></span></span><span class=\"punctuation terminator statement js\"><span>;</span></span></span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"meta function-call js\"><span class=\"meta arguments js\"><span>&nbsp;</span></span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"meta function-call js\"><span class=\"meta arguments js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"meta function-call js\"><span class=\"entity name function js\"><span>callback</span></span><span class=\"meta arguments js\"><span class=\"punctuation definition arguments begin bracket round js\"><span>(</span></span><span class=\"punctuation definition arguments end bracket round js\"><span>)</span></span></span></span><span class=\"punctuation terminator statement js\"><span>;</span></span></span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"meta function-call js\"><span class=\"meta arguments js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"punctuation definition function body end bracket curly js\"><span>}</span></span><span class=\"punctuation definition arguments end bracket round js\"><span>)</span></span></span></span><span class=\"punctuation terminator statement js\"><span>;</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"variable other object js\"><span>stream</span></span><span class=\"meta method-call js\"><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"entity name function js\"><span>on</span></span><span class=\"meta arguments js\"><span class=\"punctuation definition arguments begin bracket round js\"><span>(</span></span><span class=\"string quoted double js\"><span class=\"punctuation definition string begin js\"><span>&quot;</span></span><span>end</span><span class=\"punctuation definition string end js\"><span>&quot;</span></span></span><span class=\"meta delimiter object comma js\"><span>,</span></span><span>&nbsp;</span><span class=\"meta function js\"><span class=\"storage type function js\"><span>function</span></span><span>&nbsp;</span><span class=\"meta parameters js\"><span class=\"punctuation definition parameters begin bracket round js\"><span>(</span></span><span class=\"punctuation definition parameters end bracket round js\"><span>)</span></span></span></span><span>&nbsp;</span><span class=\"punctuation definition function body begin bracket curly js\"><span>{</span></span></span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"meta method-call js\"><span class=\"meta arguments js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"comment line double-slash js\"><span class=\"punctuation definition comment js\"><span>//</span></span><span>&nbsp;这里可以做些收尾工作</span></span></span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"meta method-call js\"><span class=\"meta arguments js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"punctuation definition function body end bracket curly js\"><span>}</span></span><span class=\"punctuation definition arguments end bracket round js\"><span>)</span></span></span></span><span class=\"punctuation terminator statement js\"><span>;</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"keyword control js\"><span>return</span></span><span>&nbsp;stream</span><span class=\"punctuation terminator statement js\"><span>;</span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"punctuation definition function body end bracket curly js\"><span>}</span></span><span class=\"punctuation terminator statement js\"><span>;</span></span></span></div></pre>\n<h2> </h2>\n<h3>流截获方式二：</h3>\n<pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"source js\"><span class=\"storage type var js\"><span>var</span></span><span>&nbsp;through&nbsp;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&nbsp;</span><span class=\"meta function-call js\"><span class=\"support function js\"><span>require</span></span><span class=\"meta arguments js\"><span class=\"punctuation definition arguments begin bracket round js\"><span>(</span></span><span class=\"string quoted single js\"><span class=\"punctuation definition string begin js\"><span>&#39;</span></span><span>through2</span><span class=\"punctuation definition string end js\"><span>&#39;</span></span></span><span class=\"punctuation definition arguments end bracket round js\"><span>)</span></span></span></span><span class=\"punctuation terminator statement js\"><span>;</span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"storage type var js\"><span>var</span></span><span>&nbsp;fs&nbsp;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&nbsp;</span><span class=\"meta function-call js\"><span class=\"support function js\"><span>require</span></span><span class=\"meta arguments js\"><span class=\"punctuation definition arguments begin bracket round js\"><span>(</span></span><span class=\"string quoted double js\"><span class=\"punctuation definition string begin js\"><span>&quot;</span></span><span>fs</span><span class=\"punctuation definition string end js\"><span>&quot;</span></span></span><span class=\"punctuation definition arguments end bracket round js\"><span>)</span></span></span></span><span class=\"punctuation terminator statement js\"><span>;</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"support variable js\"><span>module</span></span><span class=\"meta function js\"><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"entity name function js\"><span>exports</span></span><span>&nbsp;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&nbsp;</span><span class=\"storage type function js\"><span>function</span></span><span>&nbsp;</span><span class=\"meta parameters js\"><span class=\"punctuation definition parameters begin bracket round js\"><span>(</span></span><span class=\"variable parameter function js\"><span>opt</span></span><span class=\"punctuation definition parameters end bracket round js\"><span>)</span></span></span></span><span>&nbsp;</span><span class=\"punctuation definition function body begin bracket curly js\"><span>{</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"storage type var js\"><span>var</span></span><span>&nbsp;aopHeader&nbsp;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&nbsp;</span><span class=\"string quoted double js\"><span class=\"punctuation definition string begin js\"><span>&quot;</span></span><span>(</span><span class=\"punctuation definition string end js\"><span>&quot;</span></span></span><span>&nbsp;</span><span class=\"keyword operator js\"><span>+</span></span><span>&nbsp;</span><span class=\"meta brace round js\"><span>(</span></span><span class=\"variable other object js\"><span>opt</span></span><span class=\"meta delimiter property period js\"><span>.</span></span><span class=\"variable other property js\"><span>header</span></span><span>&nbsp;</span><span class=\"keyword operator logical js\"><span>||</span></span><span>&nbsp;</span><span class=\"meta function js\"><span class=\"storage type function js\"><span>function</span></span><span class=\"meta parameters js\"><span class=\"punctuation definition parameters begin bracket round js\"><span>(</span></span><span class=\"punctuation definition parameters end bracket round js\"><span>)</span></span></span></span><span class=\"punctuation definition function body begin bracket curly js\"><span>{</span></span><span class=\"punctuation definition function body end bracket curly js\"><span>}</span></span><span class=\"meta brace round js\"><span>)</span></span><span class=\"meta method-call js\"><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"support function js\"><span>toString</span></span><span class=\"meta arguments js\"><span class=\"punctuation definition arguments begin bracket round js\"><span>(</span></span><span class=\"punctuation definition arguments end bracket round js\"><span>)</span></span></span></span><span>&nbsp;</span><span class=\"keyword operator js\"><span>+</span></span><span>&nbsp;</span><span class=\"string quoted double js\"><span class=\"punctuation definition string begin js\"><span>&quot;</span></span><span>());</span><span class=\"punctuation definition string end js\"><span>&quot;</span></span></span><span class=\"punctuation terminator statement js\"><span>;</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"storage type var js\"><span>var</span></span><span>&nbsp;aopFooter&nbsp;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&nbsp;</span><span class=\"string quoted double js\"><span class=\"punctuation definition string begin js\"><span>&quot;</span></span><span>(</span><span class=\"punctuation definition string end js\"><span>&quot;</span></span></span><span>&nbsp;</span><span class=\"keyword operator js\"><span>+</span></span><span>&nbsp;</span><span class=\"meta brace round js\"><span>(</span></span><span class=\"variable other object js\"><span>opt</span></span><span class=\"meta delimiter property period js\"><span>.</span></span><span class=\"variable other property js\"><span>footer</span></span><span>&nbsp;</span><span class=\"keyword operator logical js\"><span>||</span></span><span>&nbsp;</span><span class=\"meta function js\"><span class=\"storage type function js\"><span>function</span></span><span class=\"meta parameters js\"><span class=\"punctuation definition parameters begin bracket round js\"><span>(</span></span><span class=\"punctuation definition parameters end bracket round js\"><span>)</span></span></span></span><span class=\"punctuation definition function body begin bracket curly js\"><span>{</span></span><span class=\"punctuation definition function body end bracket curly js\"><span>}</span></span><span class=\"meta brace round js\"><span>)</span></span><span class=\"meta method-call js\"><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"support function js\"><span>toString</span></span><span class=\"meta arguments js\"><span class=\"punctuation definition arguments begin bracket round js\"><span>(</span></span><span class=\"punctuation definition arguments end bracket round js\"><span>)</span></span></span></span><span>&nbsp;</span><span class=\"keyword operator js\"><span>+</span></span><span>&nbsp;</span><span class=\"string quoted double js\"><span class=\"punctuation definition string begin js\"><span>&quot;</span></span><span>());</span><span class=\"punctuation definition string end js\"><span>&quot;</span></span></span><span class=\"punctuation terminator statement js\"><span>;</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"meta function js\"><span class=\"storage type function js\"><span>function</span></span><span>&nbsp;</span><span class=\"entity name function js\"><span>bufferContents</span></span><span class=\"meta parameters js\"><span class=\"punctuation definition parameters begin bracket round js\"><span>(</span></span><span class=\"variable parameter function js\"><span>file</span></span><span class=\"meta delimiter object comma js\"><span>,</span></span><span>&nbsp;</span><span class=\"variable parameter function js\"><span>encoding</span></span><span class=\"meta delimiter object comma js\"><span>,</span></span><span>&nbsp;</span><span class=\"variable parameter function js\"><span>callback</span></span><span class=\"punctuation definition parameters end bracket round js\"><span>)</span></span></span></span><span>&nbsp;</span><span class=\"punctuation definition function body begin bracket curly js\"><span>{</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"keyword control js\"><span>if</span></span><span>&nbsp;</span><span class=\"meta brace round js\"><span>(</span></span><span class=\"variable other object js\"><span>file</span></span><span class=\"meta method-call js\"><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"entity name function js\"><span>isNull</span></span><span class=\"meta arguments js\"><span class=\"punctuation definition arguments begin bracket round js\"><span>(</span></span><span class=\"punctuation definition arguments end bracket round js\"><span>)</span></span></span></span><span class=\"meta brace round js\"><span>)</span></span><span>&nbsp;</span><span class=\"meta brace curly js\"><span>{</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"variable language js\"><span>this</span></span><span class=\"meta method-call js\"><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"support function js\"><span>push</span></span><span class=\"meta arguments js\"><span class=\"punctuation definition arguments begin bracket round js\"><span>(</span></span><span>file</span><span class=\"punctuation definition arguments end bracket round js\"><span>)</span></span></span></span><span class=\"punctuation terminator statement js\"><span>;</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"keyword control js\"><span>return</span></span><span>&nbsp;</span><span class=\"meta function-call js\"><span class=\"entity name function js\"><span>callback</span></span><span class=\"meta arguments js\"><span class=\"punctuation definition arguments begin bracket round js\"><span>(</span></span><span class=\"punctuation definition arguments end bracket round js\"><span>)</span></span></span></span><span class=\"punctuation terminator statement js\"><span>;</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"meta brace curly js\"><span>}</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"keyword control js\"><span>if</span></span><span>&nbsp;</span><span class=\"meta brace round js\"><span>(</span></span><span class=\"variable other object js\"><span>file</span></span><span class=\"meta method-call js\"><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"entity name function js\"><span>isStream</span></span><span class=\"meta arguments js\"><span class=\"punctuation definition arguments begin bracket round js\"><span>(</span></span><span class=\"punctuation definition arguments end bracket round js\"><span>)</span></span></span></span><span class=\"meta brace round js\"><span>)</span></span><span>&nbsp;</span><span class=\"meta brace curly js\"><span>{</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"variable language js\"><span>this</span></span><span class=\"meta method-call js\"><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"support function js\"><span>push</span></span><span class=\"meta arguments js\"><span class=\"punctuation definition arguments begin bracket round js\"><span>(</span></span><span>file</span><span class=\"punctuation definition arguments end bracket round js\"><span>)</span></span></span></span><span class=\"punctuation terminator statement js\"><span>;</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"keyword control js\"><span>return</span></span><span>&nbsp;</span><span class=\"meta function-call js\"><span class=\"entity name function js\"><span>callback</span></span><span class=\"meta arguments js\"><span class=\"punctuation definition arguments begin bracket round js\"><span>(</span></span><span class=\"punctuation definition arguments end bracket round js\"><span>)</span></span></span></span><span class=\"punctuation terminator statement js\"><span>;</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"meta brace curly js\"><span>}</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"keyword control js\"><span>if</span></span><span>&nbsp;</span><span class=\"meta brace round js\"><span>(</span></span><span class=\"variable other object js\"><span>file</span></span><span class=\"meta method-call js\"><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"entity name function js\"><span>isBuffer</span></span><span class=\"meta arguments js\"><span class=\"punctuation definition arguments begin bracket round js\"><span>(</span></span><span class=\"punctuation definition arguments end bracket round js\"><span>)</span></span></span></span><span class=\"meta brace round js\"><span>)</span></span><span>&nbsp;</span><span class=\"meta brace curly js\"><span>{</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"variable other object js\"><span>file</span></span><span class=\"meta delimiter property period js\"><span>.</span></span><span class=\"variable other property js\"><span>contents</span></span><span>&nbsp;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&nbsp;</span><span class=\"meta class instance constructor js\"><span class=\"keyword operator new js\"><span>new</span></span><span>&nbsp;</span><span class=\"entity name type instance js\"><span>Buffer</span></span></span><span class=\"meta brace round js\"><span>(</span></span><span>aopHeader&nbsp;</span><span class=\"keyword operator js\"><span>+</span></span><span>&nbsp;</span><span class=\"variable other object js\"><span>file</span></span><span class=\"meta delimiter property period js\"><span>.</span></span><span class=\"variable other object property js\"><span>contents</span></span><span class=\"meta method-call js\"><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"support function js\"><span>toString</span></span><span class=\"meta arguments js\"><span class=\"punctuation definition arguments begin bracket round js\"><span>(</span></span><span class=\"string quoted single js\"><span class=\"punctuation definition string begin js\"><span>&#39;</span></span><span>utf8</span><span class=\"punctuation definition string end js\"><span>&#39;</span></span></span><span class=\"punctuation definition arguments end bracket round js\"><span>)</span></span></span></span><span>&nbsp;</span><span class=\"keyword operator js\"><span>+</span></span><span>&nbsp;aopFooter</span><span class=\"meta brace round js\"><span>)</span></span><span class=\"punctuation terminator statement js\"><span>;</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"meta brace curly js\"><span>}</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"variable language js\"><span>this</span></span><span class=\"meta method-call js\"><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"support function js\"><span>push</span></span><span class=\"meta arguments js\"><span class=\"punctuation definition arguments begin bracket round js\"><span>(</span></span><span>file</span><span class=\"punctuation definition arguments end bracket round js\"><span>)</span></span></span></span><span class=\"punctuation terminator statement js\"><span>;</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"meta function-call js\"><span class=\"entity name function js\"><span>callback</span></span><span class=\"meta arguments js\"><span class=\"punctuation definition arguments begin bracket round js\"><span>(</span></span><span class=\"punctuation definition arguments end bracket round js\"><span>)</span></span></span></span><span class=\"punctuation terminator statement js\"><span>;</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"punctuation definition function body end bracket curly js\"><span>}</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"meta function js\"><span class=\"storage type function js\"><span>function</span></span><span>&nbsp;</span><span class=\"entity name function js\"><span>endStream</span></span><span class=\"meta parameters js\"><span class=\"punctuation definition parameters begin bracket round js\"><span>(</span></span><span class=\"variable parameter function js\"><span>callback</span></span><span class=\"punctuation definition parameters end bracket round js\"><span>)</span></span></span></span><span>&nbsp;</span><span class=\"punctuation definition function body begin bracket curly js\"><span>{</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"comment line double-slash js\"><span class=\"punctuation definition comment js\"><span>//</span></span><span>&nbsp;这里可以做些收尾工作</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"meta function-call js\"><span class=\"entity name function js\"><span>callback</span></span><span class=\"meta arguments js\"><span class=\"punctuation definition arguments begin bracket round js\"><span>(</span></span><span class=\"punctuation definition arguments end bracket round js\"><span>)</span></span></span></span><span class=\"punctuation terminator statement js\"><span>;</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"punctuation definition function body end bracket curly js\"><span>}</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"source js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"keyword control js\"><span>return</span></span><span>&nbsp;</span><span class=\"variable other object js\"><span>through</span></span><span class=\"meta method-call js\"><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"entity name function js\"><span>obj</span></span><span class=\"meta arguments js\"><span class=\"punctuation definition arguments begin bracket round js\"><span>(</span></span><span>bufferContents</span><span class=\"meta delimiter object comma js\"><span>,</span></span><span>&nbsp;endStream</span><span class=\"punctuation definition arguments end bracket round js\"><span>)</span></span></span></span><span class=\"punctuation terminator statement js\"><span>;</span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"punctuation definition function body end bracket curly js\"><span>}</span></span><span class=\"punctuation terminator statement js\"><span>;</span></span></span></div></pre>\n<blockquote>\n<p>编写自己的 Gulp 插件，流控制是基础。</p>\n</blockquote>\n<hr>","frontmatter":{"path":"/m5EMxLkw8rhWmyW1AEQWOQ7u","title":"Gulp流控制","date":"2016-01-31 23:38:00 +0800","comments":true,"categories":"programming","author":"Sir0xb","tags":["coffee","gulp"]}}},"pageContext":{}}