{"data":{"markdownRemark":{"html":"<p>上一篇做了导航菜单、弄出了博文列表、博文预览及翻页器。</p>\n<p>基本的功能弄的差不多了，不过还需要用这些基本功能再完善一下博客。</p>\n<p>首页也需要改改、返回顶部的按钮、还有本人比较喜欢的滚动条进度条、统计、Google被搜索等等。</p>\n<hr>\n<h2>6. 改版首页</h2>\n<p>博客首页的传统实现方式是显示部分博文，下方再加个 Read More 的按钮。</p>\n<p>只有一种首页是不是太单调了，在特殊节日我想搞个特效页面什么的展示在首页。\n所以，我弄了个配置，如果是普通日子，就默认用传统的有分页，博文部分显示的首页。\n如果是特殊节日，根据开发的特效页面不同，也能很快的进行切换。</p>\n<!--more-->\n<p>首先，我们把原先的入口文件 <code>src/pages/index.js</code> 更名或删除。</p>\n<p>并创建模板文件 <code>src/templates/home.js</code></p>\n<pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"text plain null-grammar\"><span>import&nbsp;React&nbsp;from&nbsp;&#39;react&#39;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>import&nbsp;Layout&nbsp;from&nbsp;&#39;../components/layout&#39;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>import&nbsp;HomePage&nbsp;from&nbsp;&#39;../components/Home&#39;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>import&nbsp;SEO&nbsp;from&nbsp;&#39;../components/seo&#39;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>const&nbsp;Template&nbsp;=&nbsp;({&nbsp;pageContext&nbsp;})&nbsp;=&gt;&nbsp;(</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t&lt;Layout&gt;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t&lt;SEO&nbsp;title=&quot;Boliball&quot;&nbsp;/&gt;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t&lt;HomePage&nbsp;type=&quot;normal&quot;&nbsp;pageContext={pageContext}&nbsp;/&gt;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t&lt;/Layout&gt;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>)</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>export&nbsp;default&nbsp;Template</span></span></div></pre>\n<p>通过这种方式，我们可以把给入模板文件的页面上下文转移到 <code>src/components/Home/index.jsx</code> 里。</p>\n<p>我们再改下高级渲染方式 <code>gatsby-node.js</code>，把组织数据部分弄一弄。</p>\n<pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"text plain null-grammar\"><span>...</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>//&nbsp;生成首页</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>const&nbsp;HomeTemplate&nbsp;=&nbsp;path.resolve(&#39;./src/templates/home.js&#39;)</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>createPaginatedPages({</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\tedges&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;result.data.allMarkdownRemark.edges,</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\tcreatePage&nbsp;&nbsp;&nbsp;:&nbsp;createPage,</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\tpageTemplate&nbsp;:&nbsp;HomeTemplate,</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\tpageLength&nbsp;&nbsp;&nbsp;:&nbsp;5,</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\tpathPrefix&nbsp;&nbsp;&nbsp;:&nbsp;&#39;&#39;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>})</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>...</span></span></div></pre>\n<p>上下文数据有了，模板也有了，弄一弄首页 Component 吧。</p>\n<p>先弄一个组件路由。</p>\n<pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"text plain null-grammar\"><span>import&nbsp;React&nbsp;from&nbsp;&#39;react&#39;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>import&nbsp;PropTypes&nbsp;from&nbsp;&#39;prop-types&#39;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>import&nbsp;NormalHomePage&nbsp;from&nbsp;&#39;./normal&#39;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>import&nbsp;HolidayHomePage&nbsp;from&nbsp;&#39;./holiday&#39;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>const&nbsp;HomeComponentMapping&nbsp;=&nbsp;{</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\tnormal&nbsp;&nbsp;:&nbsp;NormalHomePage,</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\tholiday&nbsp;:&nbsp;HolidayHomePage</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>}</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>const&nbsp;HomePage&nbsp;=&nbsp;({&nbsp;type,&nbsp;pageContext&nbsp;})&nbsp;=&gt;&nbsp;{</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\tconst&nbsp;TheHomePage&nbsp;=&nbsp;HomeComponentMapping[type]</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\treturn&nbsp;&lt;TheHomePage&nbsp;pageContext={pageContext}&nbsp;/&gt;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>}</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>HomePage.propTypes&nbsp;=&nbsp;{</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\ttype:&nbsp;PropTypes.string</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>}</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>HomePage.defaultProps&nbsp;=&nbsp;{</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\ttype:&nbsp;&#39;normal&#39;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>}</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>export&nbsp;default&nbsp;HomePage</span></span></div></pre>\n<p>再把带分页的首页弄一弄。</p>\n<pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"text plain null-grammar\"><span>import&nbsp;React&nbsp;from&nbsp;&#39;react&#39;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>import&nbsp;{&nbsp;Link&nbsp;}&nbsp;from&nbsp;&#39;gatsby&#39;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>import&nbsp;Paginator&nbsp;from&nbsp;&#39;../Paginator&#39;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>import&nbsp;&#39;./style.css&#39;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>const&nbsp;{&nbsp;Fragment&nbsp;}&nbsp;=&nbsp;React</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>const&nbsp;NormalHomePage&nbsp;=&nbsp;({&nbsp;pageContext&nbsp;})&nbsp;=&gt;&nbsp;{</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\tconst&nbsp;{</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\tgroup,</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\tindex,</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\tpageCount</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t}&nbsp;=&nbsp;pageContext</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\treturn&nbsp;&lt;Fragment&gt;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t{group.map(({&nbsp;node&nbsp;})&nbsp;=&gt;&nbsp;(</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t\t&lt;div&nbsp;className=&quot;normal-homepage-item&quot;&nbsp;key={node.id}&gt;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t\t\t&lt;h3&gt;&lt;Link&nbsp;className=&quot;title&quot;&nbsp;to={node.frontmatter.path}&gt;{node.frontmatter.title}&lt;/Link&gt;&lt;/h3&gt;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t\t\t&lt;small&gt;Posted&nbsp;by&nbsp;{node.frontmatter.author}&nbsp;on&nbsp;{node.frontmatter.date}&lt;/small&gt;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t\t\t&lt;br/&gt;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t\t\t&lt;br/&gt;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t\t\t&lt;div&nbsp;dangerouslySetInnerHTML={{__html:&nbsp;node.html.split(&#39;&lt;!--more--&gt;&#39;)[0]}}&gt;&lt;/div&gt;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t\t\t&lt;Link&nbsp;to={node.frontmatter.path}&gt;Read&nbsp;More&lt;/Link&gt;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t\t\t&lt;br/&gt;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t\t&lt;/div&gt;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t))}</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t&lt;Paginator&nbsp;index={index}&nbsp;pageCount={pageCount}&nbsp;relativeUrl=&quot;&quot;&nbsp;/&gt;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t&lt;/Fragment&gt;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>}</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>export&nbsp;default&nbsp;NormalHomePage</span></span></div></pre>\n<p><font color=\"red\">注：博文里需要有识别符 <code>&#x3C;!--more--></code>。之所以首页能只显示一部分，是因为使用这个识别符做了拆分。</font></p>\n<hr>\n<h2>7. 返回顶部</h2>\n<p>返回顶部的实现方式有很多种，这里只作为示例。</p>\n<pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"text plain null-grammar\"><span>import&nbsp;React&nbsp;from&nbsp;&#39;react&#39;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>import&nbsp;&#39;./style.css&#39;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>class&nbsp;BackToTop&nbsp;extends&nbsp;React.Component&nbsp;{</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\tconstructor(props)&nbsp;{</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\tsuper(props)</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\tthis.state&nbsp;=&nbsp;{</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t\tshow:&nbsp;false</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t}</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\tthis.timer&nbsp;=&nbsp;undefined</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\tthis.scrollHandle&nbsp;=&nbsp;this.scrollHandle.bind(this)</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t}</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\tcomponentDidMount()&nbsp;{</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\twindow.addEventListener(&#39;scroll&#39;,&nbsp;this.scrollHandle)</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t}</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\tcomponentWillUnmount()&nbsp;{</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\twindow.removeEventListener(&#39;scroll&#39;,&nbsp;this.scrollHandle)</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t}</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\tscrollHandle()&nbsp;{</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\tclearTimeout(this.timer)</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\tthis.timer&nbsp;=&nbsp;setTimeout(()&nbsp;=&gt;&nbsp;{</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t\tthis.setState({</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t\t\tshow:&nbsp;document.body.scrollTop&nbsp;&gt;&nbsp;700&nbsp;||&nbsp;document.documentElement.scrollTop&nbsp;&gt;&nbsp;700</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t\t})</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t},&nbsp;100)</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t}</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\trender()&nbsp;{</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\treturn&nbsp;this.state.show&nbsp;&amp;&amp;&nbsp;&lt;div&nbsp;className=&quot;back-to-top&quot;&gt;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t\t&lt;button&nbsp;onClick={()&nbsp;=&gt;&nbsp;{&nbsp;window.scrollTo(0,&nbsp;0)&nbsp;}}&gt;⬆︎&lt;/button&gt;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t&lt;/div&gt;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t}</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>}</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>export&nbsp;default&nbsp;BackToTop</span></span></div></pre>\n<hr>\n<h2>8. 滚动条进度条</h2>\n<pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"text plain null-grammar\"><span>import&nbsp;React&nbsp;from&nbsp;&#39;react&#39;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>import&nbsp;&#39;./style.css&#39;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>class&nbsp;ScrollIndicator&nbsp;extends&nbsp;React.Component&nbsp;{</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\tconstructor(props)&nbsp;{</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\tsuper(props)</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\tthis.scrollHandle&nbsp;=&nbsp;this.scrollHandle.bind(this)</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t}</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\tcomponentDidMount()&nbsp;{</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\twindow.addEventListener(&#39;scroll&#39;,&nbsp;this.scrollHandle)</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t}</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\tcomponentWillUnmount()&nbsp;{</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\twindow.removeEventListener(&#39;scroll&#39;,&nbsp;this.scrollHandle)</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t}</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\tscrollHandle()&nbsp;{</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\tlet&nbsp;winScroll&nbsp;=&nbsp;document.body.scrollTop&nbsp;||&nbsp;document.documentElement.scrollTop</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\tlet&nbsp;height&nbsp;=&nbsp;document.documentElement.scrollHeight&nbsp;-&nbsp;document.documentElement.clientHeight</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\tlet&nbsp;scrolled&nbsp;=&nbsp;(winScroll&nbsp;/&nbsp;height)&nbsp;*&nbsp;100</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\tthis.refs.progress_bar.style.width&nbsp;=&nbsp;`${scrolled}%`</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t}</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\trender()&nbsp;{</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\treturn&nbsp;&lt;div&nbsp;className=&quot;scroll-indicator&quot;&gt;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t\t&lt;div&nbsp;ref=&quot;progress_bar&quot;&nbsp;className=&quot;progress-bar&quot;&gt;&lt;/div&gt;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t&lt;/div&gt;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t}</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>}</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>export&nbsp;default&nbsp;ScrollIndicator</span></span></div></pre>\n<hr>\n<h2>9. 百度统计 &#x26; 被 Google 搜索</h2>\n<p>Google统计的脚本在国内有时候加载不成功，都懂得。</p>\n<p>不废话，安装百度统计的中间件。</p>\n<pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"text plain null-grammar\"><span>npm&nbsp;i&nbsp;gatsby-plugin-baidu-tongji</span></span></div></pre>\n<p>修改下配置文件 <code>gatsby-config.js</code></p>\n<pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"text plain null-grammar\"><span>...</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>plugins:&nbsp;[</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t...</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t{</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\tresolve:&nbsp;&#39;gatsby-plugin-baidu-tongji&#39;,</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\toptions:&nbsp;{</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t\tsiteid:&nbsp;&#39;FiJx5NYvSMLLCLCO9Ep9AmCEYpnhLZEo&#39;,</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t\thead:&nbsp;false</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\t}</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t}</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t...</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>]</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>...</span></span></div></pre>\n<p>被 Google 搜索需要在 <a href=\"https://search.google.com/search-console\">search.google.com</a> 上注册自己的站点。</p>\n<p>站点的验证方式很多，这里用举例 meta 方式。修改 <code>src/components/seo.js</code>。</p>\n<pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"text plain null-grammar\"><span>...</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>meta={[</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t...</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t{</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\tname:&nbsp;`google-site-verification`,</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t\tcontent:&nbsp;&#39;axWre5Mc1WeCJHuCSLAALonVYdzjco_Ao__dvd3CsYX&#39;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t}</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>\t...</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>]}</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>...</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>`</span></span></div></pre>\n<hr>\n<h2>10. 发布站点脚本 &#x26; CNAME 文件</h2>\n<p>运行如下命令：</p>\n<pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"text plain null-grammar\"><span>gatsby&nbsp;build</span></span></div></pre>\n<p>待发布的站点就在 <code>public</code> 目录里了</p>\n<p>为了发布方便做了个发布脚本 <code>deploy.sh</code></p>\n<pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"text plain null-grammar\"><span>#!/bin/bash</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>rm&nbsp;-rf&nbsp;./.cache</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>rm&nbsp;-rf&nbsp;./public/*</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>gatsby&nbsp;build</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>echo&nbsp;&quot;&quot;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>echo&nbsp;&quot;====&gt;&gt;&nbsp;publish&nbsp;version:&nbsp;$1&nbsp;&lt;&lt;====&quot;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>echo&nbsp;&quot;&quot;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>&nbsp;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>cd&nbsp;./public</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>git&nbsp;add&nbsp;.</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>git&nbsp;commit&nbsp;-m&nbsp;&quot;$1&quot;</span></span></div><div class=\"line\"><span class=\"text plain null-grammar\"><span>git&nbsp;push</span></span></div></pre>\n<p><font color=\"red\">注：发布前最好清理一下 <code>public</code> 目录，因为总是增量发布，所以会有很多历史文件，同一个功能只是 hash 有变化。</font></p>\n<p>配置 <code>package.json</code></p>\n<pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"source json\"><span>...</span></span></div><div class=\"line\"><span class=\"source json\"><span class=\"string quoted double json\"><span class=\"punctuation definition string begin json\"><span>&quot;</span></span><span>scripts</span><span class=\"punctuation definition string end json\"><span>&quot;</span></span></span><span>:&nbsp;</span><span class=\"meta structure dictionary json\"><span class=\"punctuation definition dictionary begin json\"><span>{</span></span></span></span></div><div class=\"line\"><span class=\"source json\"><span class=\"meta structure dictionary json\"><span>\t</span><span class=\"invalid illegal expected-dictionary-separator json\"><span>.</span><span>.</span><span>.</span></span></span></span></div><div class=\"line\"><span class=\"source json\"><span class=\"meta structure dictionary json\"><span>\t</span><span class=\"string quoted double json\"><span class=\"punctuation definition string begin json\"><span>&quot;</span></span><span>deploy</span><span class=\"punctuation definition string end json\"><span>&quot;</span></span></span><span class=\"meta structure dictionary value json\"><span class=\"punctuation separator dictionary key-value json\"><span>:</span></span><span>&nbsp;</span><span class=\"string quoted double json\"><span class=\"punctuation definition string begin json\"><span>&quot;</span></span><span>sh&nbsp;deploy.sh</span><span class=\"punctuation definition string end json\"><span>&quot;</span></span></span></span></span></span></div><div class=\"line\"><span class=\"source json\"><span class=\"meta structure dictionary json\"><span class=\"meta structure dictionary value json\"><span>\t</span><span class=\"invalid illegal expected-dictionary-separator json\"><span>.</span><span>.</span><span>.</span></span></span></span></span></div><div class=\"line\"><span class=\"source json\"><span class=\"meta structure dictionary json\"><span class=\"punctuation definition dictionary end json\"><span>}</span></span></span></span></div><div class=\"line\"><span class=\"source json\"><span>...</span></span></div></pre>\n<p>使用方法如下：</p>\n<pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"text plain null-grammar\"><span>npm&nbsp;run&nbsp;deploy&nbsp;--&nbsp;v0.0.1</span></span></div></pre>\n<p>另：如果自己有独立域名，还需要将 CNAME 文件放入发布目录。</p>\n<p>只需要将 CNAME 文件放入 <code>static/</code> 目录即可，脚本编译的时候会自动同步过去。</p>\n<hr>\n<h4>- THE END -</h4>","frontmatter":{"path":"/KGZEuDpCK0Kporkdhg8iy1KQ","title":"用 Gatsby 搭建静态博客 2","date":"2019-02-01 10:28:00  +0800","comments":true,"categories":"programming","author":"Sir0xb","tags":["Gatsby","React"]}}},"pageContext":{}}